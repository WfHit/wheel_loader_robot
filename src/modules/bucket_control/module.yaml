module_name: Bucket Control

parameters:
    - group: Bucket Control
      definitions:

        BCT_ENABLED:
            description:
                short: Enable bucket control module
                long: |
                    Enable the bucket control module for wheel loader applications.

                    0: Disabled
                    1: Enabled
            type: int32
            min: 0
            max: 1
            default: 1
            reboot_required: true

        BCT_UPDATE_RATE:
            description:
                short: Control loop update rate (Hz)
                long: |
                    Update rate for the bucket control loop.
                    Higher rates provide better control performance but use more CPU.
            type: float
            min: 10.0
            max: 200.0
            default: 50.0
            unit: Hz

        BCT_MOTOR_IDX:
            description:
                short: Motor instance index
                long: |
                    Instance index for the bucket actuator motor in the hbridge system.
            type: int32
            min: 0
            max: 7
            default: 0

        BCT_ENC_IDX:
            description:
                short: Encoder instance index
                long: |
                    Instance index for the bucket actuator encoder in the quadrature encoder system.
            type: int32
            min: 0
            max: 7
            default: 0

    - group: Bucket Kinematics
      definitions:

        BCT_ACT_BASE_X:
            description:
                short: Actuator base X coordinate (mm)
                long: |
                    X coordinate of actuator base attachment point relative to boom pivot.
            type: float
            min: -1000.0
            max: 1000.0
            default: 0.0
            unit: mm

        BCT_ACT_BASE_Y:
            description:
                short: Actuator base Y coordinate (mm)
                long: |
                    Y coordinate of actuator base attachment point relative to boom pivot.
            type: float
            min: -1000.0
            max: 1000.0
            default: 0.0
            unit: mm

        BCT_BCK_BOOM_X:
            description:
                short: Bellcrank boom X coordinate (mm)
                long: |
                    X coordinate of bellcrank attachment point on boom.
            type: float
            min: -1000.0
            max: 1000.0
            default: 0.0
            unit: mm

        BCT_BCK_BOOM_Y:
            description:
                short: Bellcrank boom Y coordinate (mm)
                long: |
                    Y coordinate of bellcrank attachment point on boom.
            type: float
            min: -1000.0
            max: 1000.0
            default: 0.0
            unit: mm

        BCT_BKT_PIV_X:
            description:
                short: Bucket pivot X coordinate (mm)
                long: |
                    X coordinate of bucket pivot point relative to boom pivot.
            type: float
            min: -2000.0
            max: 2000.0
            default: 0.0
            unit: mm

        BCT_BKT_PIV_Y:
            description:
                short: Bucket pivot Y coordinate (mm)
                long: |
                    Y coordinate of bucket pivot point relative to boom pivot.
            type: float
            min: -2000.0
            max: 2000.0
            default: 0.0
            unit: mm

        BCT_BCK_LEN:
            description:
                short: Bellcrank length (mm)
                long: |
                    Length of bellcrank arm from pivot to coupler attachment.
            type: float
            min: 50.0
            max: 500.0
            default: 150.0
            unit: mm

        BCT_COUP_LEN:
            description:
                short: Coupler length (mm)
                long: |
                    Length of coupler link between bellcrank and bucket.
            type: float
            min: 100.0
            max: 1000.0
            default: 300.0
            unit: mm

        BCT_ACT_OFF:
            description:
                short: Actuator offset (mm)
                long: |
                    Distance from bellcrank pivot to actuator attachment point.
            type: float
            min: 50.0
            max: 300.0
            default: 100.0
            unit: mm

        BCT_BKT_ARM_LEN:
            description:
                short: Bucket arm length (mm)
                long: |
                    Length of bucket arm from pivot to cutting edge.
            type: float
            min: 200.0
            max: 1000.0
            default: 500.0
            unit: mm

        BCT_BCK_INT_ANG:
            description:
                short: Bellcrank internal angle (rad)
                long: |
                    Internal angle of bellcrank between actuator and coupler arms.
            type: float
            min: 0.5
            max: 3.0
            default: 1.57
            unit: rad

        BCT_BKT_OFF:
            description:
                short: Bucket offset angle (rad)
                long: |
                    Offset angle of bucket relative to coupler link.
            type: float
            min: -1.57
            max: 1.57
            default: 0.0
            unit: rad

        BCT_ACT_MIN:
            description:
                short: Actuator minimum length (mm)
                long: |
                    Minimum extension length of actuator (fully retracted).
            type: float
            min: 100.0
            max: 400.0
            default: 200.0
            unit: mm

        BCT_ACT_MAX:
            description:
                short: Actuator maximum length (mm)
                long: |
                    Maximum extension length of actuator (fully extended).
            type: float
            min: 300.0
            max: 800.0
            default: 500.0
            unit: mm

        BCT_ANG_MIN:
            description:
                short: Bucket minimum angle (rad)
                long: |
                    Minimum bucket angle (dump position).
            type: float
            min: -1.57
            max: 0.0
            default: -0.5
            unit: rad

        BCT_ANG_MAX:
            description:
                short: Bucket maximum angle (rad)
                long: |
                    Maximum bucket angle (load position).
            type: float
            min: 0.0
            max: 1.57
            default: 0.5
            unit: rad

        BCT_BOOM_LENGTH:
            description:
                short: Boom length (mm)
                long: |
                    Length of the boom from pivot point to bucket attachment point.
                    This is the primary dimension of the boom pivot triangle.
            type: float
            min: 1000.0
            max: 3000.0
            default: 2000.0
            unit: mm

        BCT_BOOM_PIV_CRK:
            description:
                short: Boom pivot to crank joint distance (mm)
                long: |
                    Distance from boom pivot point to bellcrank joint attachment point.
                    This defines the geometry of the boom pivot triangle.
            type: float
            min: 200.0
            max: 2000.0
            default: 1000.0
            unit: mm

        BCT_BCK_CRK_DIST:
            description:
                short: Bucket to crank joint distance (mm)
                long: |
                    Distance from bucket base to bellcrank joint attachment point.
                    This completes the boom pivot triangle geometry.
            type: float
            min: 150.0
            max: 1500.0
            default: 750.0
            unit: mm

        BCT_CRK_ARM_LEN:
            description:
                short: Bellcrank arm length (mm)
                long: |
                    Length of the bellcrank arm from the bellcrank pivot to coupler attachment.
                    This defines one side of the bellcrank triangle.
            type: float
            min: 100.0
            max: 600.0
            default: 300.0
            unit: mm

        BCT_CRK_COUPLER:
            description:
                short: Bellcrank to coupler distance (mm)
                long: |
                    Distance from bellcrank pivot to coupler joint attachment point.
                    This defines another side of the bellcrank triangle.
            type: float
            min: 150.0
            max: 800.0
            default: 400.0
            unit: mm

        BCT_CRK_ACT_DIST:
            description:
                short: Bellcrank to actuator distance (mm)
                long: |
                    Distance from bellcrank pivot to actuator attachment point.
                    This completes the bellcrank triangle geometry.
            type: float
            min: 150.0
            max: 700.0
            default: 350.0
            unit: mm

    - group: Bucket Control
      definitions:

        BCT_POS_P:
            description:
                short: Position control P gain
                long: |
                    Proportional gain for position control loop.
            type: float
            min: 0.0
            max: 10.0
            default: 1.0

        BCT_POS_I:
            description:
                short: Position control I gain
                long: |
                    Integral gain for position control loop.
            type: float
            min: 0.0
            max: 2.0
            default: 0.1

        BCT_POS_D:
            description:
                short: Position control D gain
                long: |
                    Derivative gain for position control loop.
            type: float
            min: 0.0
            max: 1.0
            default: 0.05

        BCT_VEL_P:
            description:
                short: Velocity control P gain
                long: |
                    Proportional gain for velocity control loop.
            type: float
            min: 0.0
            max: 20.0
            default: 2.0

        BCT_VEL_I:
            description:
                short: Velocity control I gain
                long: |
                    Integral gain for velocity control loop.
            type: float
            min: 0.0
            max: 5.0
            default: 0.2

        BCT_VEL_D:
            description:
                short: Velocity control D gain
                long: |
                    Derivative gain for velocity control loop.
            type: float
            min: 0.0
            max: 1.0
            default: 0.01

        BCT_MAX_VEL:
            description:
                short: Maximum velocity
                long: |
                    Maximum actuator velocity for motion planning.
            type: float
            min: 10.0
            max: 500.0
            default: 100.0
            unit: ""

        BCT_MAX_ACC:
            description:
                short: Maximum acceleration
                long: |
                    Maximum actuator acceleration for motion planning.
            type: float
            min: 50.0
            max: 1000.0
            default: 200.0
            unit: ""

        BCT_MAX_JERK:
            description:
                short: Maximum jerk
                long: |
                    Maximum actuator jerk for smooth motion planning.
            type: float
            min: 100.0
            max: 5000.0
            default: 1000.0
            unit: ""

        BCT_DUTY_LIM:
            description:
                short: Duty cycle limit
                long: |
                    Maximum duty cycle for actuator motor (0.0 to 1.0).
            type: float
            min: 0.1
            max: 1.0
            default: 1.0

    - group: Boom Compensation
      definitions:

        BCT_BOOM_GAIN:
            description:
                short: Boom derivative gain
                long: |
                    Gain for boom velocity feedforward in compensation.
            type: float
            min: 0.0
            max: 1.0
            default: 0.1

        BCT_BOOM_DEAD:
            description:
                short: Boom deadband (rad)
                long: |
                    Deadband for boom movement to avoid noise-induced compensation.
            type: float
            min: 0.0001
            max: 0.01
            default: 0.001
            unit: rad

        BCT_BOOM_FACT:
            description:
                short: Boom compensation factor
                long: |
                    Base compensation factor for converting boom angle to actuator adjustment.
            type: float
            min: 50.0
            max: 500.0
            default: 250.0
            unit: ""

    - group: Calibration
      definitions:

        BCT_CAL_FAST_SPD:
            description:
                short: Calibration fast speed
                long: |
                    Fast movement speed during calibration sequence.
            type: float
            min: 10.0
            max: 200.0
            default: 50.0
            unit: ""

        BCT_CAL_SLOW_SPD:
            description:
                short: Calibration slow speed
                long: |
                    Slow movement speed for precise limit detection.
            type: float
            min: 1.0
            max: 50.0
            default: 10.0
            unit: ""

        BCT_CAL_REQUIRED:
            description:
                short: Calibration required
                long: |
                    Require calibration on startup.

                    0: Not required
                    1: Required
            type: int32
            min: 0
            max: 1
            default: 1

        BCT_CAL_MARGIN:
            description:
                short: Calibration margin (mm)
                long: |
                    Safety margin from limit switches for operational range.
            type: float
            min: 1.0
            max: 20.0
            default: 5.0
            unit: mm

    - group: Hardware Configuration
      definitions:

        BCT_LMT_LOAD_IDX:
            description:
                short: Load limit sensor index
                long: |
                    Instance index for load limit sensor (bucket down position).
            type: int32
            min: 0
            max: 7
            default: 0

        BCT_LMT_DUMP_IDX:
            description:
                short: Dump limit sensor index
                long: |
                    Instance index for dump limit sensor (bucket up position).
            type: int32
            min: 0
            max: 7
            default: 1

        BCT_ENC_SCALE:
            description:
                short: Encoder scale factor
                long: |
                    Scale factor to convert encoder radians to actuator length in mm.
            type: float
            min: 1.0
            max: 1000.0
            default: 100.0
            unit: ""

        BCT_ENC_OFFSET:
            description:
                short: Encoder zero offset (rad)
                long: |
                    Encoder offset for zero position calibration.
            type: float
            min: -6.28
            max: 6.28
            default: 0.0
            unit: rad

        BCT_ACT_MIN_LEN:
            description:
                short: Actuator minimum length (mm)
                long: |
                    Physical minimum length of actuator (hardware limit).
            type: float
            min: 100.0
            max: 400.0
            default: 150.0
            unit: mm

        BCT_ACT_MAX_LEN:
            description:
                short: Actuator maximum length (mm)
                long: |
                    Physical maximum length of actuator (hardware limit).
            type: float
            min: 300.0
            max: 800.0
            default: 550.0
            unit: mm

        # Drive Kinematics Parameters
        BCT_MOTOR_BASE_X:
            description:
                short: Motor base X coordinate (mm)
                long: |
                    X coordinate of motor base in machine body frame.
            type: float
            min: -1000.0
            max: 1000.0
            default: 0.0
            unit: mm

        BCT_MOTOR_BASE_Y:
            description:
                short: Motor base Y coordinate (mm)
                long: |
                    Y coordinate of motor base in machine body frame.
            type: float
            min: -1000.0
            max: 1000.0
            default: 0.0
            unit: mm

        BCT_CRK_PIV_LEN:
            description:
                short: Crank pivot length (mm)
                long: |
                    Length of crank pivot arm for drive kinematics.
            type: float
            min: 50.0
            max: 500.0
            default: 100.0
            unit: mm

        BCT_CRK_PIV_ANG:
            description:
                short: Crank pivot angle (deg)
                long: |
                    Initial angle of crank pivot arm for drive kinematics.
            type: float
            min: -180.0
            max: 180.0
            default: 0.0
            unit: deg

        BCT_BELLCRK_LEN:
            description:
                short: Bellcrank arm length (mm)
                long: |
                    Length of the bellcrank arm in the drive kinematics linkage system.
                    This is the BC link in the four-bar mechanism.
            type: float
            min: 50.0
            max: 500.0
            default: 200.0
            unit: mm

        BCT_ENC_POS_MIN:
            description:
                short: Encoder minimum position (mm)
                long: |
                    Minimum actuator position limit based on quadrature encoder readings.
                    Used for operational range safety validation.
            type: float
            min: 0.0
            max: 1000.0
            default: 100.0
            unit: mm

        BCT_ENC_POS_MAX:
            description:
                short: Encoder maximum position (mm)
                long: |
                    Maximum actuator position limit based on quadrature encoder readings.
                    Used for operational range safety validation.
            type: float
            min: 0.0
            max: 1000.0
            default: 500.0
            unit: mm

        # H-Bridge Control Parameters
        BCT_HBG_MIN_LEN:
            description:
                short: H-bridge minimum length (mm)
                long: |
                    Minimum length setting for H-bridge control.
            type: float
            min: 100.0
            max: 600.0
            default: 200.0
            unit: mm

        BCT_HBG_MAX_LEN:
            description:
                short: H-bridge maximum length (mm)
                long: |
                    Maximum length setting for H-bridge control.
            type: float
            min: 200.0
            max: 800.0
            default: 600.0
            unit: mm
